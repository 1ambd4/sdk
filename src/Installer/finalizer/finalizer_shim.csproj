<Project Sdk="Microsoft.NET.Sdk">

  <!-- <PropertyGroup>
    <BuildArchitecture>$([System.Runtime.InteropServices.RuntimeInformation]::ProcessArchitecture.ToString().ToLowerInvariant())</BuildArchitecture>
    <Architecture Condition="'$(Architecture)' == '' AND ('$(BuildArchitecture)' == 'arm64' OR '$(BuildArchitecture)' == 'arm')">$(BuildArchitecture)</Architecture>
    <Architecture Condition="'$(Architecture)' == '' AND '$(BuildArchitecture)' == 's390x'">$(BuildArchitecture)</Architecture>
    <Architecture Condition="'$(Architecture)' == '' AND '$(BuildArchitecture)' == 'ppc64le'">$(BuildArchitecture)</Architecture>
    <Architecture Condition="'$(Architecture)' == '' AND '$(BuildArchitecture)' == 'loongarch64'">$(BuildArchitecture)</Architecture>
    <Architecture Condition="'$(Architecture)' == ''">x64</Architecture>
  </PropertyGroup> -->

  <!-- This is a shim project to restore the WiX library and copy out the *.lib and *.h files so we can build the finalizer. -->
  <PropertyGroup>
    <!-- <Platform Condition="'$(Platform)' == 'AnyCPU' Or '$(Platform)' == ''">$(Architecture)</Platform> -->
    <Platform>x64</Platform>
    <TargetFramework>$(SdkTargetFramework)</TargetFramework>
    <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
    <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
    <ProduceReferenceAssembly>false</ProduceReferenceAssembly>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Signed.Wix" GeneratePathProperty="true" />
  </ItemGroup>

  <ItemGroup>
    <NativeProjectReference Include="CMakeLists.txt" CMakeProject="finalizer.proj" BuildNative="true" />
  </ItemGroup>
  
  <!-- This target needs to run before the native project reference is built. -->
  <Target Name="CopySdk" AfterTargets="Restore" BeforeTargets="Build">
    <ItemGroup>
      <WixLib Include="$(WixSdkPath)vs2017\lib\**\*.*" />
      <WixInclude Include="$(WixSdkPath)inc\**\*.*" />
    </ItemGroup>

    <!-- Copy all the lib files for x86, x64, and arm64 -->
    <Copy SourceFiles="@(WixLib)" DestinationFiles="@(WixLib->'$(ArtifactsDir)WixSdk\lib\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(WixInclude)" DestinationFolder="$(ArtifactsDir)WixSdk\inc" SkipUnchangedFiles="true" />
  </Target>

  <Import Project="ProjectReference.targets" Sdk="Microsoft.DotNet.CMake.Sdk" />

</Project>
